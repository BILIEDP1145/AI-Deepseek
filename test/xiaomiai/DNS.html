<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>XIAOMI-AI-DNSTEST</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            font-family: "Microsoft YaHei", Arial, sans-serif;
        }

        .test-box {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        button {
            padding: 10px 20px;
            background: #1890ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #096dd9;
        }

        #status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: #1890ff;
            display: flex;
            align-items: center;
            padding-left: 20px;
        }

        #ip-tooltip {
            color: white;
            position: absolute;
            bottom: 35px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 8px 12px;
            border-radius: 4px;
            display: none;
            font-size: 14px;
        }

        #status-bar:hover #ip-tooltip {
            display: block;
        }

        .result {
            margin-top: 15px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 4px;
            min-height: 20px;
        }
    </style>
</head>
<body>
    <div class="test-box">
        <h2>网速测试</h2>
        <button onclick="startSpeedTest()">开始测速</button>
        <div id="speedResult" class="result"></div>
    </div>

    <div class="test-box">
        <h2>服务连通性测试</h2>
        <button onclick="checkService()">测试 ai.xiaomiai.us.kg/INFO</button>
        <div id="serviceResult" class="result"></div>
    </div>

    <div id="status-bar">
        <div id="ip-tooltip">正在获取IP信息...</div>
    </div>

    <script>
        // 获取IP信息
        function fetchIP() {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    fetch(`https://ipapi.co/${data.ip}/json/`)
                        .then(res => res.json())
                        .then(location => {
                            const ipInfo = `IP: ${data.ip} (${location.city} - ${location.country_name})`;
                            document.getElementById('ip-tooltip').textContent = ipInfo;
                        });
                })
                .catch(() => {
                    document.getElementById('ip-tooltip').textContent = 'IP信息获取失败';
                });
        }

        // 初始化获取IP
        fetchIP();

        // 网速测试
        function startSpeedTest() {
            const result = document.getElementById('speedResult');
            result.innerHTML = '正在测试...';
            
            const testFile = 'https://source.unsplash.com/random/6000x6000'; // 约7MB测试文件
            const startTime = performance.now();

            fetch(testFile)
                .then(response => {
                    const fileSize = response.headers.get('content-length');
                    const duration = (performance.now() - startTime) / 1000;
                    const speed = (fileSize * 8 / (duration * 1024 * 1024)).toFixed(2);
                    result.innerHTML = `
                        下载速度：<b>${speed} Mbps</b><br>
                        延迟：${duration.toFixed(2)}秒<br>
                        测试文件大小：${(fileSize / 1024 / 1024).toFixed(2)} MB
                    `;
                })
                .catch(() => {
                    result.innerHTML = '测速失败，请检查网络连接';
                });
        }

        // 服务连通性测试
        function checkService() {
            const result = document.getElementById('serviceResult');
            result.innerHTML = '正在测试 ai.xiaomiai.us.kg/INFO 的连通性...';
            
            const testUrl = 'https://ai.xiaomiai.us.kg/INFO';
            const startTime = Date.now();

            fetch(testUrl, { mode: 'no-cors', cache: 'no-cache' })
                .then(() => {
                    const latency = Date.now() - startTime;
                    result.innerHTML = `
                        <span style="color: #52c41a;">✓ 连接成功</span><br>
                        延迟：${latency}ms
                    `;
                })
                .catch(() => {
                    result.innerHTML = '<span style="color: #ff4d4f;">✗ 连接失败</span>';
                });
        }
    </script>
</body>
</html>